# git

## Конфигурация

Конфигурация git представляет собой совокупность пар ключ:значение.
Проверить значение конкретной настройки по ключу можно командой

```sh
git config <ключ.настройки>
```

Установка любой настройки происходит по шаблону

```sh
git config <флаг-уровеня-хранения-настройки> <ключ.настройки> <значение-настройки>
```

У git есть 3 уровня настроек

1. системные, уровень операционной системы (флаг `--system`, файл `/etc/gitconfig`)
1. глобальные, уровень пользователя (флаг `--global`, файл `~/.gitconfig`)
1. уровня репозитория (флаг `--local`, файл `./.git/config` в корне репозитория)

### Diff tool

Показать помощь по конфигурации difftool.
Данная команда покажет список преднастроенных в самом git инструментов для сравнения файлов

```sh
git difftool --tool-help
```

Установить *kdiff3* в качестве *difftool*

```sh
git config --global diff.tool kdiff3
```

## Коммит

### Указываем в параметре дату коммита

```sh
git commit --date '2025-07-16T01:03:39'
```

## Полезные команды

### Удаление ветки на сервере

```sh
git push -d <remote> <branch>
```

### Удаление из локальной копии ссылок на несуществующие ветки сервера

Например, когда-то существовала ветка `origin/feature-1`, а потом её удалили с сервера.
Т.е. на сервере такой ветки уже нет, но в локальном репозитории ссылка на неё осталась.
Чтобы сделать "уборку" в своём локальном репозитории можно использовать флаг `--prune` (работает так же с `git pull`)

```sh
git fetch --prune
```

### Создать "сервер" (удалённый репозиторий) в обычной директории на компьютере

Bare-репозитории (т.е. репозитории без рабочей копии) принято называть с суффиксом `.git`

```sh
mkdir /какой/то/путь/my-repo.git
cd /какой/то/путь/my-repo.git
git init --bare
```

Затем такой репозиторий можно склонировать привычным способом указав в качестве сервера
путь к директории с созданным репозиторием (работает даже относительный путь)

```sh
git clone /какой/то/путь/my-repo.git
```

### Добавить ещё один сервер в локальный репозиторий

```sh
git remote add <remote-name> <url>
```

### Отправить любую ветку на любой сервер

```sh
git push <remote> <branch>
```

## Бэкап репозитория

1. Клонировать репозиторий с параметром `--bare`
   ```shell
   git clone --bare <удалённый-репозиторий>
    ```
2. По необходимости забирать изменения в ветках и сами новые ветки
   ```shell
   git fetch origin *:*
    ```
   Можно сделать небольшой скрипт `fetch.sh` который заходит в каждую папку bare-репозитория и обновляет содержимое
   ```shell
   START_DIR=$(pwd)
   
   for repo_dir in ./*.git ; do
           echo Try to update $repo_dir ...
   
           cd $repo_dir
   
           for remote in `git remote show`; do
                   git fetch --prune $remote *:* ;
           done;
   
           cd $START_DIR
   
           echo
   done;
   ```